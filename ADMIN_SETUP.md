# 🔐 관리자 페이지 설정 가이드

관리자 페이지를 사용하려면 Firestore에 관리자 정보를 등록해야 합니다.

## 1단계: Firestore에 관리자 추가

Firebase Console에서 다음 단계를 따라주세요:

1. **Firestore Database**로 이동
2. **데이터** 탭 클릭
3. **컬렉션 시작** 클릭
4. 컬렉션 ID: `admins` 입력
5. 문서 ID: 관리자의 Firebase UID 입력 (또는 자동 생성)
6. 필드 추가:
   - `email` (문자열): 관리자 이메일 주소
     - 필드 이름: `email`
     - 유형: **문자열** 선택
     - 값: 관리자 이메일 입력 (예: `admin@example.com`)
   
   - `createdAt` (타임스탬프): 생성일시
     - 필드 이름: `createdAt`
     - 유형: **타임스탬프** 선택
     - 날짜/시간 입력:
       - **방법 1 (권장)**: 날짜와 시간 필드에서 **현재 시간 사용** 버튼 클릭
       - **방법 2**: 수동으로 날짜와 시간 입력
         - 날짜: 오늘 날짜 선택 (예: 2024-01-15)
         - 시간: 현재 시간 입력 (예: 14:30:00)
     - ⚠️ **참고**: 타임스탬프 필드는 선택사항입니다. `email` 필드만 있어도 관리자로 인식됩니다.

### 예시:

```
컬렉션: admins
문서 ID: [관리자의 Firebase UID]
필드:
  - email: "admin@example.com" (문자열)
  - createdAt: [현재 시간] (타임스탬프, 선택사항)
```

### 타임스탬프 필드 추가 상세 가이드:

1. **필드 추가** 버튼 클릭
2. 필드 이름에 `createdAt` 입력
3. 유형 드롭다운에서 **타임스탬프** 선택
4. 날짜와 시간 입력:
   - **캘린더 아이콘** 클릭 → 오늘 날짜 선택
   - **시계 아이콘** 클릭 → 현재 시간 입력
   - 또는 **"현재 시간 사용"** 버튼이 있다면 클릭 (가장 간편)
5. **저장** 버튼 클릭

💡 **팁**: `createdAt` 필드는 선택사항입니다. 관리자 인증에는 `email` 필드만 필요합니다. 타임스탬프는 나중에 언제 관리자가 추가되었는지 추적하고 싶을 때만 사용하세요.

## 2단계: 관리자 UID 확인 방법

관리자로 지정할 사용자의 Firebase UID를 확인하는 방법:

1. 해당 사용자로 로그인 (Google 로그인 또는 이메일/비밀번호 로그인 중 실제로 사용할 방식으로)
2. 브라우저 개발자 도구 열기 (F12)
3. 콘솔에서 다음 코드 실행:
   ```javascript
   import { getAuth } from 'firebase/auth';
   console.log(getAuth().currentUser?.uid);
   ```
4. 또는 Firebase Console > Authentication > Users에서 UID 확인

⚠️ **중요**: 
- **Google 로그인**과 **이메일/비밀번호 로그인**은 서로 다른 UID를 가집니다
- 같은 이메일 주소라도 로그인 방식에 따라 UID가 다릅니다
- 실제로 사용할 로그인 방식으로 로그인한 후 UID를 확인해야 합니다

### 예시:
- `iseoul72@gmail.com`으로 Google 로그인 → UID: `abc123...`
- `iseoul72@gmail.com`으로 이메일/비밀번호 로그인 → UID: `xyz789...` (다름!)

따라서:
- Google 로그인을 사용한다면 → Google 로그인으로 로그인한 후 UID 확인
- 이메일/비밀번호 로그인을 사용한다면 → 이메일/비밀번호로 로그인한 후 UID 확인

## 3단계: 관리자 페이지 접근

### 방법 1: 헤더 메뉴에서 접근 (가장 간단)

1. **관리자로 등록할 때 사용한 로그인 방식**으로 로그인
   - Google 로그인으로 등록했다면 → Google 로그인 사용
   - 이메일/비밀번호로 등록했다면 → 이메일/비밀번호 로그인 사용

2. 로그인 후 상단 헤더를 확인
   - 헤더 오른쪽에 **"🔐 관리자"** 링크가 빨간색으로 표시됩니다
   - 이 링크는 관리자 계정으로 로그인한 경우에만 보입니다

3. **"🔐 관리자"** 링크 클릭
   - 관리자 대시보드로 이동합니다

### 방법 2: 직접 URL 입력

1. 관리자 계정으로 로그인
2. 브라우저 주소창에 `/admin` 입력
3. 관리자 대시보드가 표시됩니다

### 관리자 메뉴 위치

관리자 계정으로 로그인하면 헤더에 다음 메뉴들이 표시됩니다:
- 대시보드
- 내 서재
- 통계
- 업적
- 랭킹
- 📊 여정 현황
- 프로필
- **🔐 관리자** ← 관리자만 보이는 메뉴 (빨간색)

💡 **팁**: 
- 관리자 등록 시 사용한 로그인 방식과 동일한 방식으로 로그인해야 관리자 권한이 인식됩니다
- 관리자 계정은 공통 현황판과 랭킹에서 자동으로 제외됩니다

## 관리자 페이지 기능

- **통계 대시보드**: 전체 사용자, 책, 독서 기록 통계 확인
- **사용자 관리**: 등록된 사용자 목록 및 정보 확인
- **책 관리**: 등록된 책 목록 및 진행 상황 확인

## 보안 주의사항

⚠️ **중요**: Firestore 보안 규칙을 업데이트하여 관리자 컬렉션을 보호하세요:

```javascript
// admins 컬렉션은 읽기 전용 (관리자 확인용)
match /admins/{adminId} {
  allow read: if request.auth != null;
  allow write: if false; // 수동으로만 추가 가능
}
```

## 관리자 추가/제거

관리자를 추가하거나 제거하려면 Firebase Console에서 `admins` 컬렉션의 문서를 직접 추가/삭제하세요.

## 문제 해결

### 관리자 페이지에 접근할 수 없는 경우

1. Firestore에 `admins` 컬렉션이 생성되었는지 확인
2. 문서 ID가 현재 로그인한 사용자의 UID와 일치하는지 확인
3. 브라우저 콘솔에서 오류 메시지 확인

### 관리자 권한이 인식되지 않는 경우

#### 1단계: 디버깅 페이지 확인

1. 브라우저에서 `/admin/debug` 접속
2. 페이지에서 다음 정보 확인:
   - 현재 사용자의 UID
   - useAuth 훅의 관리자 인식 결과
   - 직접 isAdmin() 호출 결과

#### 2단계: Firestore 확인

**가장 흔한 원인: 문서 ID가 UID와 일치하지 않음**

1. Firebase Console → Firestore Database → 데이터 탭
2. `admins` 컬렉션 확인
3. 디버깅 페이지에 표시된 UID와 문서 ID가 **정확히 일치**하는지 확인
   - UID: `abc123def456...` (디버깅 페이지에서 확인)
   - 문서 ID: `abc123def456...` (Firestore에서 확인)
   - ⚠️ **대소문자, 공백, 특수문자까지 정확히 일치해야 합니다**

#### 3단계: 로그인 방식 확인

**중요**: 관리자 등록 시 사용한 로그인 방식과 동일한 방식으로 로그인해야 합니다.

- Google 로그인으로 등록했다면 → Google 로그인 사용
- 이메일/비밀번호로 등록했다면 → 이메일/비밀번호 로그인 사용

**같은 이메일이라도 로그인 방식에 따라 UID가 다릅니다!**

#### 4단계: 브라우저 콘솔 확인

**참고**: 브라우저 콘솔에서는 `import` 문을 직접 사용할 수 없습니다. 대신 디버깅 페이지(`/admin/debug`)를 사용하거나, 다음 방법을 사용하세요:

1. 브라우저 개발자 도구 열기 (F12)
2. 콘솔 탭에서 오류 메시지 확인
3. **디버깅 페이지 사용 (권장)**:
   - `/admin/debug` 페이지로 이동
   - 페이지에서 모든 정보를 확인할 수 있습니다

**또는** React DevTools 사용:
- React DevTools 확장 프로그램 설치
- Components 탭에서 `useAuth` 훅의 상태 확인

#### 5단계: 해결 방법

**문제가 발견되면:**

1. **문서 ID가 UID와 다름**
   - Firestore에서 기존 문서 삭제
   - 새 문서 생성 시 문서 ID를 **정확한 UID**로 설정
   - 또는 기존 문서의 문서 ID를 UID로 변경

2. **로그인 방식이 다름**
   - 올바른 로그인 방식으로 로그인
   - 해당 UID로 관리자 등록

3. **admins 컬렉션이 없음**
   - `admins` 컬렉션 생성
   - 문서 ID를 사용자의 UID로 설정
   - `email` 필드 추가 (선택사항)

4. **캐시 문제**
   - 로그아웃 후 다시 로그인
   - 브라우저 캐시 삭제
   - 페이지 새로고침 (Ctrl+F5 또는 Cmd+Shift+R)

#### 6단계: 확인

수정 후:
1. 로그아웃 후 다시 로그인
2. `/admin/debug` 페이지에서 관리자 상태 확인
3. 헤더에 "🔐 관리자" 링크가 표시되는지 확인

